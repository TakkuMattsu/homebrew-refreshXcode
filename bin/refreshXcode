#!/bin/bash

# =====================================
# variable

DERIVED_DATA_DIR=~/Library/Developer/Xcode/DerivedData
DEVICE_SUPPORT_DIR=~/Library/Developer/Xcode/iOS\ DeviceSupport
DIRS="$DERIVED_DATA_DIR,$DEVICE_SUPPORT_DIR"
PROGNAME=$(basename $0)
VERSION="1.2"

# =====================================
# function

# Input fucntion
function readInput()
{
  echo ""
  echo -n "Delete Cache of Xcode. Are you sure ? (y/n) > "
  read INPUT
  echo ""
  # ,を区切り文字に
  PRE_IFS=$IFS
  IFS=$','
  if [ "$INPUT" == "y" ]; then
    for dir in ${DIRS}
    do
      isExistCacheDirectory ${dir}
      if [ $? -eq -1 ]; then
        echo ""
        continue
      fi
      echo "Delete ${dir} ..."
      rm -rf "${dir}"
    done
  elif [ "$INPUT" == "n" ]; then
    echo "Bye.."
    exit
  else
    echo "Please \"y\" or \"n\""
    readInput
  fi
}

# Check directory function
function isExistCacheDirectory()
{
  if [ -e "$1" ]; then
    return 0
  else
    echo "$1 does not exist :("
    echo ""
    return -1
  fi
}


function usage()
{
  echo "Usage: $PROGNAME [OPTION]"
  echo 
  echo "Mandatory arguments to long options are mandatory for short options too."
  echo
  echo "-h, --help	show help"
  echo "    --version	show version"
  echo
  exit 0
}

# =====================================
# main

for OPT in "$@"
do
  case "$OPT" in
  # ヘルプメッセージ
  '-h'|'--help' )
    usage
    exit 0
    ;;
  # バージョンメッセージ
  '--version' )
    echo $VERSION
    exit 0
    ;;
  esac
done

# 引数ない場合
echo "============================"
echo "Delete Xcocde cache script"
echo "============================"
readInput

echo "Done.."
